{{define "jobs-cards"}}
{{range .Jobs}}
<div class="job-card" 
     data-job-id="{{.ID}}"
     data-job-status="{{.LastStatus}}"
     data-next-run="{{.NextRun.Unix}}">
    
    <!-- Status indicator -->
    <div class="job-status status-{{.LastStatus}}">
        {{if .IsRunning}}
        <div class="status-indicator running">
            <div class="pulse"></div>
        </div>
        {{else if eq .LastStatus.String "success"}}
        <div class="status-indicator success">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                <path d="M20 6L9 17l-5-5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
        </div>
        {{else if eq .LastStatus.String "failed"}}
        <div class="status-indicator failed">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                <path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
        </div>
        {{else}}
        <div class="status-indicator idle"></div>
        {{end}}
    </div>
    
    <!-- Schedule and command -->
    <div class="job-header">
        <div class="job-schedule" title="{{.Schedule}}">
            <svg class="icon" width="14" height="14" viewBox="0 0 24 24" fill="none">
                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                <path d="M12 6v6l4 2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
            <code>{{.Schedule}}</code>
        </div>
        <div></div><!-- Spacer for grid -->
        <div class="job-header-actions">
            <button class="btn-compact"
                    {{if and .Enabled (not .IsRunning)}}
                    hx-post="/api/jobs/{{.ID}}/run"
                    hx-swap="none"
                    hx-confirm="Run job now: {{.Command}}?"
                    hx-indicator="#run-spinner-{{.ID}}"
                    hx-on::after-request="this.disabled=true; setTimeout(() => this.disabled=false, 2000)"
                    {{else}}
                    disabled
                    {{end}}>
                <svg class="icon" width="12" height="12" viewBox="0 0 24 24" fill="none">
                    <path d="M5 3l14 9-14 9V3z" fill="currentColor"/>
                </svg>
                <span>Run</span>
            </button>
            {{if and .Enabled (not .IsRunning)}}<span id="run-spinner-{{.ID}}" class="htmx-indicator spinner-small"></span>{{end}}
        </div>
    </div>
    
    <div class="job-command">
        <svg class="icon" width="14" height="14" viewBox="0 0 24 24" fill="none">
            <rect x="3" y="4" width="18" height="14" rx="2" stroke="currentColor" stroke-width="2"/>
            <path d="M7 10l2 2-2 2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M13 14h4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
        <code title="{{.Command}}">{{truncate .Command 60}}</code>
    </div>
    
    <!-- Timing info -->
    <div class="job-timing">
        <div class="timing-item">
            <span class="timing-label">Next run:</span>
            <span class="timing-value" title="{{.NextRun.Format "2006-01-02 15:04:05"}}">
                {{timeUntil .NextRun}}{{if not .NextRun.IsZero}} ({{.NextRun.Format "Jan 2, 15:04"}}){{end}}
            </span>
        </div>
        <div class="timing-item">
            <span class="timing-label">Last run:</span>
            <span class="timing-value">{{if .LastRun.IsZero}}Never{{else}}{{humanTime .LastRun}}{{end}}</span>
        </div>
    </div>
    
</div>
{{end}}
{{end}}

{{define "jobs-list"}}
<table class="jobs-table">
    <thead>
        <tr>
            <th class="th-status">Status</th>
            <th class="th-schedule cron">Schedule</th>
            <th class="th-command">Command</th>
            <th class="th-next numeric">Next Run</th>
            <th class="th-last numeric">Last Run</th>
            <th class="th-actions">Actions</th>
        </tr>
    </thead>
    <tbody>
        {{range .Jobs}}
        <tr class="job-row" 
            data-job-id="{{.ID}}"
            data-job-status="{{.LastStatus}}"
            data-next-run="{{.NextRun.Unix}}">
            
            <td class="td-status">
                {{if .IsRunning}}
                <div class="status-badge running">
                    <div class="status-dot"></div>
                    Running
                </div>
                {{else if eq .LastStatus.String "success"}}
                <div class="status-badge success">
                    <div class="status-dot"></div>
                    Success
                </div>
                {{else if eq .LastStatus.String "failed"}}
                <div class="status-badge failed">
                    <div class="status-dot"></div>
                    Failed
                </div>
                {{else}}
                <div class="status-badge idle">
                    <div class="status-dot"></div>
                    Idle
                </div>
                {{end}}
            </td>
            
            <td class="td-schedule">
                <code class="schedule-code">{{.Schedule}}</code>
            </td>
            
            <td class="td-command command">
                <code class="command-text" title="{{.Command}}">{{truncate .Command 80}}</code>
            </td>
            
            <td class="td-next numeric">
                <span class="time-value" title="{{.NextRun.Format "2006-01-02 15:04:05"}}">
                    {{timeUntil .NextRun}}{{if not .NextRun.IsZero}} ({{.NextRun.Format "Jan 2, 15:04"}}){{end}}
                </span>
            </td>
            
            <td class="td-last numeric">
                <span class="time-value">{{if .LastRun.IsZero}}Never{{else}}{{humanTime .LastRun}}{{end}}</span>
            </td>
            
            <td class="td-actions">
                <button class="btn-compact"
                        {{if and .Enabled (not .IsRunning)}}
                        hx-post="/api/jobs/{{.ID}}/run"
                        hx-swap="none"
                        hx-confirm="Run job now: {{.Command}}?"
                        hx-indicator="#run-spinner-{{.ID}}"
                        hx-on::after-request="this.disabled=true; setTimeout(() => this.disabled=false, 2000)"
                        {{else}}
                        disabled
                        {{end}}>
                    <svg class="icon" width="12" height="12" viewBox="0 0 24 24" fill="none">
                        <path d="M5 3l14 9-14 9V3z" fill="currentColor"/>
                    </svg>
                    <span>Run</span>
                </button>
                {{if and .Enabled (not .IsRunning)}}<span id="run-spinner-{{.ID}}" class="htmx-indicator spinner-small"></span>{{end}}
            </td>
        </tr>
        {{end}}
    </tbody>
</table>
{{end}}

{{define "filter-button"}}
<button {{if .IsOOB}}hx-swap-oob="outerHTML:.filter-button"{{end}}
        hx-post="/api/filter-toggle"
        hx-target="#jobs-container"
        hx-swap="innerHTML"
        hx-vals="js:{search: document.querySelector('[name=search]')?.value || ''}"
        class="filter-button"
        title="Filter by status">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="filter-icon">
        <path d="M22 3H2l8 9.46V19l4 2v-8.54L22 3z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
    <span class="filter-label" id="filter-label">
        {{if eq .FilterMode.String "all"}}All Jobs{{else if eq .FilterMode.String "running"}}Running{{else if eq .FilterMode.String "success"}}Success{{else}}Failed{{end}}
    </span>
    {{if ne .FilterMode.String "all"}}
    <span class="filter-indicator {{.FilterMode.String}}"></span>
    {{end}}
</button>
{{end}}

{{define "sort-button"}}
<button {{if .IsOOB}}hx-swap-oob="outerHTML:.sort-button"{{end}}
        hx-post="/api/sort-toggle"
        hx-target="#jobs-container"
        hx-swap="innerHTML"
        hx-vals="js:{search: document.querySelector('[name=search]')?.value || ''}"
        class="sort-button"
        title="Change sort order">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="sort-icon">
        <path d="M3 6h18M3 12h12M3 18h6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
    </svg>
    <span class="sort-label" id="sort-label">
        {{if eq .SortMode.String "default"}}Original Order{{else if eq .SortMode.String "lastrun"}}Last Run{{else}}Next Run{{end}}
    </span>
</button>
{{end}}

{{define "jobs-container"}}
<div id="jobs-container"
     hx-get="/api/jobs"
     hx-trigger="load, every 5s"
     hx-swap="innerHTML settle:0ms"
     hx-include="[name='search']"
     class="jobs-container {{.ViewMode}}">
{{if eq .ViewMode.String "cards"}}
    {{template "jobs-cards" .}}
{{else}}
    {{template "jobs-list" .}}
{{end}}
</div>
{{end}}

{{define "view-mode-button"}}
<button hx-post="/api/view-mode"
        hx-trigger="click"
        hx-target="#jobs-container"
        hx-swap="outerHTML"
        hx-vals="js:{search: document.querySelector('[name=search]')?.value || ''}"
        {{if .IsOOB}}hx-swap-oob="outerHTML:.view-toggle"{{end}}
        class="control-btn view-toggle"
        title="Toggle view mode">
    {{if eq .ViewMode.String "cards"}}
    <!-- List icon (switch to list) -->
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <line x1="8" y1="6" x2="21" y2="6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        <line x1="8" y1="12" x2="21" y2="12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        <line x1="8" y1="18" x2="21" y2="18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        <circle cx="4" cy="6" r="1" fill="currentColor"/>
        <circle cx="4" cy="12" r="1" fill="currentColor"/>
        <circle cx="4" cy="18" r="1" fill="currentColor"/>
    </svg>
    {{else}}
    <!-- Card icon (switch to cards) -->
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <rect x="3" y="3" width="8" height="8" rx="1" stroke="currentColor" stroke-width="2"/>
        <rect x="13" y="3" width="8" height="8" rx="1" stroke="currentColor" stroke-width="2"/>
        <rect x="3" y="13" width="8" height="8" rx="1" stroke="currentColor" stroke-width="2"/>
        <rect x="13" y="13" width="8" height="8" rx="1" stroke="currentColor" stroke-width="2"/>
    </svg>
    {{end}}
</button>
{{end}}

{{define "stats-updates"}}
{{if .IsOOB}}
<span id="running-count" hx-swap-oob="innerHTML">{{.RunningCount}}</span>
<span id="next-run" hx-swap-oob="innerHTML">{{.NextRunTime}}</span>
<span id="total-count" hx-swap-oob="innerHTML">{{.TotalCount}}</span>
{{end}}
{{end}}